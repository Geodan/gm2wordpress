define("NamespaceConfig2Ol",["gdmap-core"],function(e){"use strict";return e.config2ol={},e.config2ol.tools={},e.config2ol.version="0.0.18-4",e}),define("DefaultConfigurationOptions",["NamespaceConfig2Ol","jquery"],function(e,t){"use strict";var o=null,i=e.core.Class.extend({options:{projection:"EPSG:28992",units:"m",resolutions:[3440.64,1720.32,860.16,430.08,215.04,107.52,53.76,26.88,13.44,6.72,3.36,1.68,.84,.42,.21],extent:[-285401.92,22598.08,595401.92,903401.92],center:{x:155e3,y:456e3},zoom:3},initialize:function(){Object.defineProperty(this,"projection",{get:function(){return this.options.projection}}),Object.defineProperty(this,"units",{get:function(){return this.options.units}}),Object.defineProperty(this,"resolutions",{get:function(){return this.options.resolutions}}),Object.defineProperty(this,"extent",{get:function(){return this.options.extent}}),Object.defineProperty(this,"center",{get:function(){return this.options.center}}),Object.defineProperty(this,"zoom",{get:function(){return this.options.zoom}})},override:function(e){t.extend(this.options,e)}});return e.config2ol.DefaultConfigurationOptions=function(){return null===o&&(o=new i),o}(),e}),define("LayerFactory",["NamespaceConfig2Ol","openlayers"],function(e,t){"use strict";var o=null,i=e.core.Class.extend({initialize:function(){this.LAYERTYPES={OGC_WMS:"OGC_WMS",OGC_WMTS:"OGC_WMTS",OGC_TMS:"OGC_TMS",GEOJSON:"GEOJSON",TOPOJSON:"TOPOJSON",OGC_WFS:"OGC_WFS",EMPTY:"EMPTY"}},create:function(e,t){var o=null;if(t.source&&t.source.type)switch(t.source.type.toUpperCase()){case this.LAYERTYPES.OGC_WMTS:o=this._createWMTSLayer(e,t);break;case this.LAYERTYPES.OGC_WMS:o=this._createWMSLayer(e,t);break;case this.LAYERTYPES.OGC_TMS:o=this._createTMSLayer(e,t);break;case this.LAYERTYPES.GEOJSON:o=this._createGeojsonLayer(t);break;case this.LAYERTYPES.TOPOJSON:o=this._createTopojsonLayer(t);break;case this.LAYERTYPES.OGC_WFS:o=this._createWFSLayer(t);break;case this.LAYERTYPES.EMPTY:o=this.createEmptyLayer(t);break;default:console.log('Map type: "'+t.source.type+'" is not supported.')}else console.log("Layer source is not correctly defined");return o&&(o.id=t.id),o},_createWMTSLayer:function(e,o){return new t.Layer.WMTS({name:o.title,url:this._constructWmtsUrl(o),layer:o.source.featureName,matrixSet:o.source.matrixset,matrixIds:o.source.matrixids,format:o.source.contenttype,isBaseLayer:o.isBaseLayer,transitionEffect:o.source.transitioneffect||"resize",opacity:o.options.opacity,transparent:o.options.transparent,visibility:o.options.visible,style:o.source.style||"default",requestEncoding:o.source.requestencoding||"REST",dimensions:["uid"],params:{uid:e||""}})},_createWMSLayer:function(e,o){var i=new t.Layer.WMS(o.title,o.source.url,{layers:o.source.featureName,format:o.source.contenttype,exceptions:"application/vnd.ogc.se_inimage",transparent:o.options.transparent,version:o.source.version,uid:e||""},{opacity:o.options.opacity,buffer:1,isBaseLayer:o.isBaseLayer,visibility:o.options.visible});return this._addSldParam(i,o.style),i},_createTMSLayer:function(e,o){return new t.Layer.TMS(o.title,o.source.url,{layername:o.source.featureName,type:o.source.contenttype.split("/",2)[1]+"?uid="+e||"",isBaseLayer:o.isBaseLayer,opacity:o.options.opacity,transparent:o.options.transparent,visibility:o.options.visible})},_createGeojsonLayer:function(e){var o=1e3*e.options.refreshRate,i=[new t.Strategy.Fixed];if(o>0){var r=new t.Strategy.Refresh({interval:o});i.push(r)}return new t.Layer.Vector(e.title,{strategies:i,protocol:new t.Protocol.HTTP({url:e.source.url,format:new t.Format.GeoJSON}),opacity:e.options.opacity,visibility:e.options.visible})},_createTopojsonLayer:function(e){return null},_createWFSLayer:function(e){var o=1e3*e.options.refreshRate,i=[new t.Strategy.BBOX];if(o>0){var r=new t.Strategy.Refresh({interval:o});i.push(r)}return new t.Layer.Vector(e.title,{strategies:i,styleMap:new t.StyleMap(e.options.style),protocol:new t.Protocol.WFS({url:e.source.url,version:e.source.version,featureType:e.source.featureName,featureNS:e.source.featureNS,srsName:e.source.srsName,geometryName:e.source.geometryName}),opacity:e.options.opacity,visibility:e.options.visible})},_constructWmtsUrl:function(e){var t=e.source.requestencoding||"REST",o=e.source.url;if("REST"===t.toUpperCase()){var i=e.source.contenttype.split("/",2)[1];o=(e.source.resturl||o+"/"+e.source.featureName+"/{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}."+i)+"?{uid}"}return o},_addSldParam:function(e,o){if(o&&o.url){var i={sld:o.url};t.Util.extend(e.params,i)}},createEmptyLayer:function(e){return e.id=e.id||999999,e.isBaseLayer=!0,e.options=e.options||{},e.options.opacity=1,e.options.visible="true",new t.Layer(e.title,{isBaseLayer:e.isBaseLayer,visibility:e.options.visible})}});return e.config2ol.LayerFactory=function(){return null===o&&(o=new i),o}(),e}),define("Configuration",["NamespaceConfig2Ol","openlayers","jquery","gdmap-config","DefaultConfigurationOptions","LayerFactory"],function(e,t,o){"use strict";return e.config2ol.Configuration=e.core.Class.extend({_mapConfig:null,_data:null,_layers:null,_loadPromise:null,initialize:function(t){this._data=t||null,Object.defineProperty(this,"data",{get:function(){return this._data},set:function(e){this._data=e}}),Object.defineProperty(this,"uid",{get:function(){return this._data.uid}}),Object.defineProperty(this,"map",{get:function(){return this._data.map}}),Object.defineProperty(this,"extensionUri",{get:function(){return this._data.extension_uri}}),Object.defineProperty(this,"groups",{get:function(){return this._data.groups}}),Object.defineProperty(this,"projection",{get:function(){return this._data.map.view.projection||e.config2ol.DefaultConfigurationOptions.projection}}),Object.defineProperty(this,"resolutions",{get:function(){var e=null;return this._data.map.view.resolutions&&this._data.map.view.resolutions.length>0&&(e=this._data.map.view.resolutions),e}}),Object.defineProperty(this,"maxExtent",{get:function(){var t=e.config2ol.DefaultConfigurationOptions.extent;return this._data.map.view.extent&&4===this._data.map.view.extent.length&&(t=this._data.map.view.extent),t}}),Object.defineProperty(this,"visibleExtent",{get:function(){var e=null;return this._data.map.view.visibleExtent&&4===this._data.map.view.visibleExtent.length&&(e=this._data.map.view.visibleExtent),e}}),Object.defineProperty(this,"center",{get:function(){var t=e.config2ol.DefaultConfigurationOptions.center;return this._data.map.view.center&&this._data.map.view.center.x&&this._data.map.view.center.y&&(t=this._data.map.view.center),t}}),Object.defineProperty(this,"zoom",{get:function(){return"number"==typeof this._data.map.view.zoom&&this._data.map.view.zoom>=0?this._data.map.view.zoom:e.config2ol.DefaultConfigurationOptions.zoom}}),Object.defineProperty(this,"layers",{get:function(){return this._data.map.layers}}),Object.defineProperty(this,"baseLayers",{get:function(){return o.grep(this._data.map.layers,function(e){return e.isBaseLayer})}}),Object.defineProperty(this,"visibleBaseLayers",{get:function(){return o.grep(this.baseLayers,function(e){return e.options.visible})}}),Object.defineProperty(this,"overlays",{get:function(){return o.grep(this._data.map.layers,function(e){return!e.isBaseLayer})}}),Object.defineProperty(this,"scalebar",{get:function(){return 1===o.grep(this._data.map.controls,function(e){return"scalebar"===e.name&&(e.active===!0||void 0===e.active)}).length}}),Object.defineProperty(this,"measuretool",{get:function(){var e=1===o.grep(this._data.map.controls,function(e){return"measuretool"===e.name}).length;return e}}),Object.defineProperty(this,"coordinaten",{get:function(){var e=1===o.grep(this._data.map.controls,function(e){return"coordinaten"===e.name&&(e.active===!0||void 0===e.active)}).length;return e}})},setExtensionUri:function(e){this._data.extension_uri&&0!==this._data.extension_uri.indexOf("http")&&(this._data.extension_uri=e+this._data.extension_uri)},load:function(t,i,r,n,s){s=s||{},this._data=null,this._loadPromise=o.Deferred();var a=new e.config.ConfigManager(t,i,r,s.converterOptions),c={context:this};return a.getConfigData(n,"1.0.0",c).then(this._loadResolved,this._loadRejected),this._loadPromise},_loadResolved:function(e){this._data=e,this._loadPromise.resolve()},_loadRejected:function(){console.log("failed to load config from document service"),this._loadPromise.reject()}}),e}),define("ControlNames",["NamespaceConfig2Ol"],function(e){"use strict";return e.config2ol.ControlNames={scalebar:"ScaleBar",measuretool:"MeasureTool",isochronetool:"IsochroneTool",coordinaten:"Coordinaten"},e}),define("tools/IsochroneTool",["NamespaceConfig2Ol"],function(e){"use strict";return e.config2ol.tools.IsochroneTool=e.core.Class.extend({initialize:function(t){this._serviceUrl=t,this._requestManager=new e.core.RequestManager},calculateIsochrone:function(e,t,o,i,r,n){var s=this._createUrlParams(e,t,o,i,r,n),a=encodeURI(this._serviceUrl+s);return this._requestManager.get(a)},_createUrlParams:function(e,t,o,i,r,n){switch(n){case"distance":r=r?r:5;break;case"cost":r=r?r:20;break;default:r=r?r:10,n="time"}var s="";return s+="from"===i?"fromcoordx="+e+"&fromcoordy="+t:"tocoordx="+e+"&tocoordy="+t,s+="&srs="+o,s+="&calcmode="+n,s+="&calcsize="+r,s+="&outputformat=json"}}),e}),define("controls/Isochrone",["tools/IsochroneTool","openlayers"],function(e,t){"use strict";t.Control.Isochrone=t.Class(t.Control,{layer:null,initialize:function(o,i,r){t.Control.prototype.initialize.apply(this,[r]);var n={single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1};this.handler=new t.Handler.Click(this,{click:this.onClick},n),this.layer=i,this._tool=new e.config2ol.tools.IsochroneTool(o)},onClick:function(e){var o=this.map.getLonLatFromPixel(e.xy),i=new t.Feature.Vector(new t.Geometry.Point(o.lon,o.lat));this.layer.destroyFeatures(),this.layer.addFeatures(i),this.events.triggerEvent("calculationStarted",{object:this,lonlat:o});var r=this;this._tool.calculateIsochrone(o.lon,o.lat,this.map.projection,"from",10,"time").done(function(e,o,i){var n=new t.Format.GeoJSON;r.layer.addFeatures(n.read(e)),r.events.triggerEvent("calculationFinished",{object:r,geojson:e})}).fail(function(e,t,o){r.events.triggerEvent("calculationError",{object:r,error:o})})},CLASS_NAME:"OpenLayers.Control.Isochrone"})}),define("Control",["ControlNames","openlayers","controls/Isochrone"],function(e,t){"use strict";return e.config2ol.Control=e.core.Class.extend({_name:null,_control:null,initialize:function(o,i){Object.defineProperty(this,"control",{get:function(){return this._control}}),i=i||{},i.measureElement=i.measureElement||"measure_output";var r=document.getElementById(i.measureElement);switch(null===r&&(r=document.createElement("div"),r.setAttribute("id",i.measureElement)),this._name=o,o){case e.config2ol.ControlNames.scalebar:this._control=new t.Control.ScaleLine({bottomOutUnits:"",geodesic:!0});break;case e.config2ol.ControlNames.measuretool:var n=function(e){var t=(e.geometry,e.units),o=e.order,i=e.measure,n=r,s="";s+=1===o?i.toFixed(3)+" "+t:i.toFixed(3)+" "+t+"<sup>2</sup>",n.innerHTML=s},s={Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:.3}},a=new t.Style;a.addRules([new t.Rule({symbolizer:s})]);var c=new t.StyleMap({"default":a}),l=t.Util.getParameters(window.location.href).renderer;l=l?[l]:t.Layer.Vector.prototype.renderers,this._control=new t.Control.Measure(t.Handler.Path,{geodesic:!0,persist:!0,handlerOptions:{layerOptions:{renderers:l,styleMap:c}}}),this._control.events.on({measure:n,measurepartial:n});break;case e.config2ol.ControlNames.isochronetool:var u="",f="";this._control=new t.Control.Isochrone(u,f,i);break;case e.config2ol.ControlNames.coordinaten:this._control=new t.Control.MousePosition({prefix:"",separator:" | ",numDigits:0,emptyString:""})}}}),e}),define("Map",["NamespaceConfig2Ol","openlayers","jquery","Configuration","Control"],function(e,t,o){"use strict";return e.config2ol.Map=e.core.Class.extend({_elementId:null,_configuration:null,_map:null,_layers:null,_controls:null,_initPromise:null,initialize:function(e){this._elementId=e,this._configuration=null,this._map=null,this._controls={},this._initPromise=null,Object.defineProperty(this,"configuration",{get:function(){return this._configuration}}),Object.defineProperty(this,"map",{get:function(){return this._map}}),Object.defineProperty(this,"layers",{get:function(){return this._layers}}),Object.defineProperty(this,"baseLayers",{get:function(){return o.grep(this._layers,function(e){return e.isBaseLayer})}}),Object.defineProperty(this,"visibleBaseLayers",{get:function(){return o.grep(this.baseLayers,function(e){return e.visibility})}}),Object.defineProperty(this,"overlays",{get:function(){return o.grep(this._layers,function(e){return!e.isBaseLayer})}}),Object.defineProperty(this,"controls",{get:function(){return this._controls}})},setCenter:function(){this.map.setCenter(new t.LonLat(this._configuration.getCenterX(),this._configuration.getCenterY()),this._configuration.getZoomlevel())},createMapFromConfiguration:function(t,i,r,n,s){var a=this;s=s||{};var c=s.context||this;return this._initPromise=o.Deferred(),this._configuration=new e.config2ol.Configuration,this._configuration.load(t,i,r,n,s).then(function(){try{a._createMap(s),a._initPromise.resolveWith(c,[this])}catch(e){console.log("Failed to create map from configuration: "+e),a._destroyMap(),a._initPromise.rejectWith(c)}},function(e){console.log("Error loading the configuration: "+e),a._initPromise.rejectWith(c)}),this._initPromise},createMapFromJSON:function(t){return this._configuration=new e.config2ol.Configuration(t),this._initPromise=o.Deferred(),this._createMap({}),this._initPromise.resolve(this),this._initPromise},removeLayers:function(t){for(var o=0;o<t.length;o++)for(var i=this._map.getLayersByName(t[o]),r=0;r<i.length;r++)this._removeLayer(i[r]);if(0===this.baseLayers.length){var n=e.config2ol.LayerFactory.createEmptyLayer({title:"empty"});this._layers.push(n),this._map.addLayers(this.baseLayers),this._map.setBaseLayer(this.visibleBaseLayers[0])}},_removeLayer:function(e){var t=this._layers.indexOf(e);t>=0&&(this._layers.splice(t,1),this._map.removeLayer(e,!1))},_parseLayers:function(){var t;this._layers=[];for(var o=this._configuration.data,i=0;i<o.map.layers.length;++i)t=e.config2ol.LayerFactory.create(o.uid,o.map.layers[i]),null!==t&&this._layers.push(t);0===this.baseLayers.length&&(t=e.config2ol.LayerFactory.createEmptyLayer({title:"empty"}),this._layers.push(t)),this._map.addLayers(this.overlays);var r=this.visibleBaseLayers;r.length>0&&(this._map.addLayer(r[0]),this._map.setBaseLayer(r[0])),this._map.addLayers(this.baseLayers)},_setNumZoomLevels:function(){this._map.resolutions&&this.map.resolutions.length>0&&(this._map.numZoomLevels=this.map.resolutions.length)},_createMap:function(o){if(this._map=new t.Map({div:this._elementId,theme:null,projection:this._configuration.projection,resolutions:this._configuration.resolutions,maxExtent:this._configuration.maxExtent,restrictedExtent:this._configuration.visibleExtent,center:this._configuration.center,zoom:this._configuration.zoom,units:"m"}),this._setNumZoomLevels(),this._parseLayers(),this._configuration.scalebar){var i=new e.config2ol.Control(e.config2ol.ControlNames.scalebar);this._map.addControl(i.control),this._controls[e.config2ol.ControlNames.scalebar]=i}if(this._configuration.measuretool){var r=new e.config2ol.Control(e.config2ol.ControlNames.measuretool,o);this._map.addControl(r.control),this._controls[e.config2ol.ControlNames.measuretool]=r}if(this._configuration.coordinaten){var n=new e.config2ol.Control(e.config2ol.ControlNames.coordinaten,o);this._map.addControl(n.control),this._controls[e.config2ol.ControlNames.coordinaten]=n}},_destroyMap:function(){null!==this._map&&this._map.destroy()}}),e}),define("gdmap-config2ol",["gdmap-core","Map"],function(e){"use strict";return e});
//# sourceMappingURL=gdmap-config2ol.min.js.map